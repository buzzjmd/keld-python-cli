[tox]
envlist = 
    clean
    lint
    {py27,py36}
    report

[pytest]
testpaths = tests

[testenv]
basepython =
    {py}: {env:TOXFORCEPY:{env:TOXPY:python}}
    {py2}: {env:TOXFORCEPY:{env:TOXPY2:python2}}
    {py27}: {env:TOXFORCEPY:python2.7}
    {py3,clobber,clean,lint,report}: {env:TOXFORCEPY:{env:TOXPY3:python3}}
    {py36}: {env:TOXFORCEPY:python3.6}
usedevelop=True
deps =
    pytest
    pytest-cov
passenv =
    *
commands =
    {info}: python -c "import os; print('\{basepython\}={basepython}')"
    python --version
    python -m keldcli
    {posargs:pytest --verbose --cov --cov-append --cov-report=term-missing}

[testenv:lint]
skip_install = true
deps =
    flake8
commands =
    python --version
    flake8 src/keldcli tests setup.py

[testenv:report]
skip_install = true
deps = coverage
commands =
    coverage html --fail-under=100

[testenv:clean-cov]
skip_install = true
commands = 
    # Remove coverage artifacts
    coverage erase
    find . -type d -name 'htmlcov' -exec rm -rf \{\} +

[testenv:clean-tests]
skip_install = true
commands = 
    # Remove testing artifacts
    rm -rf .tox/
	find . -type d -name '.pytest_cache' -exec rm -rf \{\} +

[testenv:clean-build]
skip_install = true
commands = 
    # Remove build artifacts
    rm -fr build/
    rm -fr dist/
    rm -fr *.egg-info

[testenv:clean-python]
skip_install = true
commands = 
    # Remove compiled Python files
    find . -type d -name '__pycache__' -exec rm -rf \{\} +
    find . -type f -name '*.py[co]' -exec rm -f \{\} +
    find . -name '*~' -exec rm -f \{\} +

[testenv:clean-downloads]
skip_install = true
commands = 
    # Remove cache for downloaded plugins
    rm -fr .eggs/

[testenv:clean]
skip_install = true
whitelist_externals =
    find
    rm
deps = 
    coverage
commands =
    {[testenv:clean-cov]commands}
    {[testenv:clean-tests]commands}
    {[testenv:clean-build]commands}
    {[testenv:clean-python]commands}

[testenv:clobber]
skip_install = true
whitelist_externals =
    {[testenv:clean]whitelist_externals}
deps = 
    {[testenv:clean]deps}
commands =
    {[testenv:clean]commands}
    {[testenv:clean-downloads]commands}
